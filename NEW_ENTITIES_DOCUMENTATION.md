# Новые сущности для курсовой работы

Добавлены 2 новые сущности со связями в базу данных для увеличения количества таблиц в курсовой работе.

## 1. Genre (Жанры музыки)

### Описание
Сущность для категоризации треков по музыкальным жанрам.

### Поля таблицы `genres`:
- `id` - Primary key
- `name` - Название жанра (уникальное, до 100 символов)
- `description` - Описание жанра (до 500 символов, nullable)
- `color` - Цвет для UI в формате HEX (#ffffff, по умолчанию #6366f1)
- `created_at`, `updated_at` - Временные метки

### Связи:
- **One-to-Many** с `tracks` (один жанр - много треков)

### API Endpoints:
- `GET /api/genres` - Список всех жанров (публичный)
- `GET /api/genres/popular` - Популярные жанры (публичный)
- `GET /api/genres/{id}` - Детали жанра (требует аутентификации)
- `POST /api/genres` - Создать жанр (требует аутентификации)
- `PUT /api/genres/{id}` - Обновить жанр (требует аутентификации)
- `DELETE /api/genres/{id}` - Удалить жанр (требует аутентификации)

### Предустановленные жанры:
- Pop, Rock, Hip Hop, Electronic, Jazz, Classical, R&B, Country, Reggae, Alternative

## 2. Playlist (Плейлисты пользователей)

### Описание
Сущность для создания пользовательских плейлистов с треками.

### Поля таблицы `playlists`:
- `id` - Primary key
- `name` - Название плейлиста (до 100 символов)
- `description` - Описание плейлиста (text, nullable)
- `is_public` - Публичный ли плейлист (boolean, по умолчанию false)
- `user_id` - Foreign key на пользователя
- `created_at`, `updated_at` - Временные метки

### Связи:
- **Many-to-One** с `users` (много плейлистов - один пользователь)
- **Many-to-Many** с `tracks` через таблицу `playlist_tracks`

### Pivot таблица `playlist_tracks`:
- `id` - Primary key
- `playlist_id` - Foreign key на плейлист
- `track_id` - Foreign key на трек
- `position` - Позиция трека в плейлисте (integer, по умолчанию 0)
- `created_at`, `updated_at` - Временные метки
- Уникальный индекс на (`playlist_id`, `track_id`)

### API Endpoints:
- `GET /api/playlists` - Плейлисты пользователя + публичные (требует аутентификации)
- `GET /api/playlists/{id}` - Детали плейлиста (требует аутентификации)
- `POST /api/playlists` - Создать плейлист (требует аутентификации)
- `PUT /api/playlists/{id}` - Обновить плейлист (требует аутентификации, только владелец)
- `DELETE /api/playlists/{id}` - Удалить плейлист (требует аутентификации, только владелец)
- `POST /api/playlists/{id}/tracks` - Добавить трек в плейлист (требует аутентификации, только владелец)
- `DELETE /api/playlists/{id}/tracks/{track_id}` - Удалить трек из плейлиста (требует аутентификации, только владелец)

## 3. Обновления существующих сущностей

### Track
Добавлено поле:
- `genre_id` - Foreign key на жанр (nullable, при удалении жанра устанавливается NULL)

### User
Добавлена связь:
- **One-to-Many** с `playlists` (один пользователь - много плейлистов)

## Функциональность

### Простые возможности (для курсовой):
1. **Жанры**:
   - Просмотр списка жанров с цветовой кодировкой
   - Подсчет количества треков в каждом жанре
   - Популярные жанры (по количеству треков)

2. **Плейлисты**:
   - Создание личных и публичных плейлистов
   - Добавление/удаление треков в плейлисты
   - Подсчет общей продолжительности плейлиста
   - Сортировка треков по позиции в плейлисте

### Безопасность
- Все изменения требуют аутентификации
- Плейлисты может редактировать только владелец
- Жанры нельзя удалить, если есть связанные треки
- Публичные эндпоинты только для чтения жанров

## Миграции
Созданы миграции:
- `2026_01_24_192009_create_genres_table.php`
- `2026_01_24_192015_create_playlists_table.php`
- `2026_01_24_192020_create_playlist_tracks_table.php`
- `2026_01_24_192025_add_genre_id_to_tracks_table.php`

## Сидеры
- `GenreSeeder.php` - Заполняет базовые жанры музыки

## Модели и контроллеры
- `Genre.php` + `GenreController.php` + `GenreResource.php`
- `Playlist.php` + `PlaylistController.php` + `PlaylistResource.php`

Эти сущности добавляют функциональность, но не влияют на основную работу приложения (комнаты, треки, голосование), что обеспечивает стабильность существующего кода.