#!/usr/bin/env bash

# Setup script for Spotik Ruby Backend

set -e

echo "Setting up Spotik Ruby Backend..."

# Check Ruby version
echo "Checking Ruby version..."
ruby_version=$(ruby -v)
echo "Ruby version: $ruby_version"

# Install bundler if not present
if ! command -v bundle &> /dev/null; then
    echo "Installing bundler..."
    gem install bundler
fi

# Install dependencies
echo "Installing Ruby dependencies..."
bundle install

# Create necessary directories
echo "Creating directories..."
mkdir -p logs
mkdir -p public
mkdir -p tmp

# Copy environment file if it doesn't exist
if [ ! -f .env ]; then
    if [ -f .env.example ]; then
        echo "Copying .env.example to .env..."
        cp .env.example .env
        echo "Please edit .env with your configuration"
    fi
fi

echo "Setup complete!"
echo ""
echo "To start the server:"
echo "  ruby server.rb"
echo ""
echo "To run tests:"
echo "  bundle exec rspec"
echo ""
echo "To run in development with auto-restart:"
echo "  bundle exec rerun ruby server.rb"