[SERVICE]
    Flush         1
    Log_Level     info
    Daemon        off
    Parsers_File  parsers.conf
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020

[INPUT]
    Name              tail
    Path              /var/log/app/*.log
    Parser            json
    Tag               ruby.app.*
    Refresh_Interval  5
    Mem_Buf_Limit     50MB

[INPUT]
    Name              tail
    Path              /var/log/nginx/access.log
    Parser            nginx
    Tag               nginx.access
    Refresh_Interval  5

[INPUT]
    Name              tail
    Path              /var/log/nginx/error.log
    Parser            nginx_error
    Tag               nginx.error
    Refresh_Interval  5

[FILTER]
    Name                kubernetes
    Match               ruby.app.*
    Kube_URL            https://kubernetes.default.svc:443
    Kube_CA_File        /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    Kube_Token_File     /var/run/secrets/kubernetes.io/serviceaccount/token
    Kube_Tag_Prefix     ruby.app.var.log.containers.
    Merge_Log           On
    Keep_Log            Off

[OUTPUT]
    Name  stdout
    Match *
    Format json_lines

# Uncomment to send logs to external systems
# [OUTPUT]
#     Name  es
#     Match *
#     Host  elasticsearch
#     Port  9200
#     Index spotik-logs
#     Type  _doc

# [OUTPUT]
#     Name  forward
#     Match *
#     Host  fluentd
#     Port  24224